# 🎨 ArtSlave 2.0 - 艺术家机会平台架构设计文档

## 📋 项目概述

ArtSlave 2.0 是面向艺术家与艺术学者的智能化投稿平台，提供**机会发现 → 匹配 → 投递 → 跟踪**的一体化流程。

### 🎯 总体目标

本系统采用**混合架构方案**，实现功能解耦与职责清晰：

* **Core 服务**：作为业务中枢，负责数据真相源、复杂逻辑、投递引擎、LLM 适配
* **n8n**：作为编排与通知层，负责定时任务、事件触发、审批流、消息推送
* **Dify**：作为 AI 子系统，负责解析补全、匹配理由、文书润色、RAG、模型切换

### ✨ 架构优势

* 各部分职责清晰、可扩展
* LLM 可随时替换（GPT/Claude/国产模型/本地 LLM）
* 兼容中国大陆环境（自托管、国产模型、飞书/企业微信通知）

---

## 🏗️ 核心模块架构（6大模块）

### 1️⃣ 数据摄取与规范化（Intake）

**职责**：
- 抓取外部来源（网站、RSS、API、邮件）
- 解析成统一结构并去重合并
- 生成标准化的 `Opportunity` 对象

**边界**：
- 只关心"从外界到内部统一模型"
- 不负责匹配、展示、投递

**输入/输出**：
- 输入：`SourceConfig`（来源配置）
- 输出：`Opportunity`（统一字段、带 fingerprint、versions）

**MVP 清单**：
- 先支持 1-2 个来源
- 规范化字段（标题/机构/截止日/链接/费用/地域/类型）
- 指纹 + 近似匹配去重
- 记录 `OpportunityVersion`（原始快照 + 解析结果）

**后续增强**：
- LLM 辅助字段抽取与摘要（通过 Dify/LLM Adapter，失败回退规则）
- 机构别名库、日期容错、反爬/登录策略库

---

### 2️⃣ 仓储与检索（Repository & Index）

**职责**：
- 存储 `Opportunity`、`Application`、`Profile` 等主数据
- 提供筛选/排序/全文检索

**边界**：
- 内部持久化与搜索
- 不做业务编排

**输入/输出**：
- 输入：来自 Intake 的 Opportunity、来自投递的 Application
- 输出：列表/详情查询结果（给 UI、匹配、编排用）

**MVP 清单**：
- 表结构定住（机会、版本、用户、作品/文档、投递、事件）
- 基础查询（按截止日/国家/类型/是否收费）
- 简易全文检索（标题+机构）

**后续增强**：
- 高级筛选（学科、资助额度、语种）
- 审计日志与变更追溯
- 收藏/标签/自定义视图

---

### 3️⃣ 匹配与 AI 服务（Matching & AI Services）

**职责**：
- 给每个 `Opportunity` 计算与用户的匹配度
- 生成"匹配理由"
- 润色文书（Statement/CV/作品描述）
- 统一对接 GPT/Claude/国产或本地模型（可热切换）

**边界**：
- 只产出分数与文本
- 不负责通知/编排

**输入/输出**：
- 输入：`Opportunity + UserPrefs/Profile`
- 输出：`Match{user_id, score, reasons}`；可选草稿文本（Statement/Cover）

**MVP 清单**：
- 规则匹配（学科/地域/费用/截止窗），达标后调用 AI 生成理由
- 统一 `llm.run(task, payload)` 接口（Dify 或自适配）
- 明确回退：AI 不可用时仅返回规则分与模板理由

**后续增强**：
- 点击/投递反馈学习
- RAG：引入机构/往届项目文档作为知识库
- 多语种生成与术语风格控制

---

### 4️⃣ 投递与跟踪（Submission & Tracking）

**职责**：
- 从用户资料自动组装投递包
- 半自动/自动填写表单、提交、拿回执
- 跟踪状态变化

**边界**：
- 只负责"一次投递"的闭环
- 不决定何时触发（编排层做）

**输入/输出**：
- 输入：`Opportunity + User Assets（CV/Statement/作品） + "提交命令"`
- 输出：`Application{state, receipt, timeline}`；审计记录（截图/原文）

**状态机**：
`Draft → Prepared → Submitted → Resulted(Win/Lose)`

**MVP 清单**：
- 半自动流程：生成清单与表单草稿，人工确认后提交
- 基础跟踪：邮件/门户关键字识别（失败再用 AI 结构化）

**后续增强**：
- 表单 DSL 与可回放脚本库
- 多站点登录态管理
- 自动提醒（D-3、缺材料、中间结果）

---

### 5️⃣ 编排与通知（Orchestration & Notifications）

**职责**（建议由 **n8n** 承担）：
- 把上面四大能力串起来：定时抓取→更新→匹配→通知→人工确认→投递→跟踪
- 定时触发、事件编排、审批与人工确认
- 多渠道通知（邮件/飞书/企业微信）
- 生成待办 `Task`

**边界**：
- 不做业务计算
- 只负责任务时序、人机交互、消息发送

**输入/输出**：
- 输入：事件（新机会、截止临近、投递结果）；人工操作（确认/拒绝）
- 输出：通知（邮件/飞书/企业微信）、Task 记录（待办）

**MVP 清单**：
- 每日抓取更新流
- 新机会匹配通知流
- 投递准备→确认→提交流
- 状态巡检通知流

**后续增强**：
- 审批与 SLA
- 灰度发布新规则
- 异常报警（抓取失败、模型失败）

---

### 6️⃣ 界面与设置（UI & Settings）

**职责**：
- 给用户最小可用界面：看机会、筛选、查看匹配/理由、管理资料、一键投递、查看进度
- 管理员配置来源、阈值、模型选择

**边界**：
- 读写都通过仓储与编排
- 不直接碰外部站点或 LLM

**输入/输出**：
- 输入：查询条件、用户操作
- 输出：列表/详情、任务/状态、配置项

**MVP 清单**：
- 列表/详情/筛选
- 我的资料 CRUD
- 投递看板（按状态分列）
- 设置页（开关某些来源、匹配阈值、LLM 选择）

**后续增强**：
- 个性化视图、批量操作
- 团队协作（多成员分配）
- 数据导出/分享

---

## 📱 页面信息架构（IA）

精简为 **4 个主页面 + 2 个管理页**：

### 1. 机会页（Opportunities）
- 列表 + 筛选/搜索/收藏
- 详情抽屉（摘要、来源、匹配理由、准备投递按钮）

### 2. 投递 & 待办页（Tasks / Applications）
- 看板：Draft / Prepared / Submitted / Resulted
- 卡片抽屉：所需材料、草稿、回执、审计截图

### 3. 我的资料页（Profile & Materials）
- 管理 CV、Statement 多版本、作品库
- 自动装配预览

### 4. 设置页（Settings）
- 偏好、通知渠道、模型选择、语言、时区

### 5. 数据源 & 编排（管理员）
- 来源开关、频率、n8n 流程健康状态

### 6. 审计 & 分析（管理员）
- 投递成功率、抓取失败率、模型调用统计

---

## 🔄 典型用户路径

### 1. 发现 → 匹配 → 投递
用户在机会页筛选 → 查看匹配分与理由 → 点击"准备投递" → 投递页卡片进入"Prepared"

### 2. 巡检 → 更新结果 → 通知
n8n 定时抓取 → Core 更新机会/投递状态 → n8n 推送通知 → 投递页卡片状态更新

---

## 🛠️ 技术栈对比与选择

### n8n vs Dify 对比

| 维度 | n8n | Dify |
|------|-----|------|
| **定位** | 通用流程编排（Zapier 开源替代） | LLM 应用平台（Prompt/RAG/多模型） |
| **强项** | 定时任务、触发器多、人工审批、消息通知、系统集成 | Prompt 管理、RAG 知识库、多模型切换、输出结构化、评测 |
| **弱项** | AI 支持基础（仅发 prompt 收文本） | 集成少，流程编排能力弱于 n8n |
| **数据与状态** | 流程实例日志 | AI 应用与资产（Prompt、知识库、模型配置） |
| **中国大陆可用性** | 强在本地集成（飞书、企业微信、DB） | 强在国产模型/本地模型接入 |

### 最佳组合方案

**两者结合 → 最适合的场景**（流程重 + AI 也重）：
- **n8n**：调度 + 通知 + 审批
- **Dify**：AI 子任务（解析、理由、文书、RAG）
- **Core**：数据与投递引擎

---

## 🚀 开发实施计划

### 建议的开发顺序（两条线并行，快速见效）

**底座线**：
`Intake（先 1-2 来源）→ Repository & Index → UI（列表/详情/筛选）`

**价值线**：
`Matching（规则分）→ n8n（新机会→通知）→ Profiles（最简）→ Submission（半自动）`

**AI 加速**：
把"解析补全 / 匹配理由 / 文书润色 / 回执结构化"接到 Dify（全部可开可关）

**运营线**：
n8n 加巡检流与 D-3 截止提醒；UI 加投递看板与设置页

---

## 📊 系统架构图

```
          ┌───────────────────────── 用户界面 & 设置（UI & Settings） ─────────────────────────┐
          │   浏览机会 / 匹配理由 / 我的资料 / 投递看板 / 系统设置（来源、阈值、模型）          │
          └──────────────────────────────────────────────────────────────────────────────────┘
                                    │                         ▲
                                    │ 查询/操作                │ 展示/操作结果
                                    ▼                         │
┌─────────────────────── Orchestration & Notifications（n8n） ───────────────────────┐
│ 定时触发 / 事件编排 / 审批与人工确认 / 通知（邮件/飞书/企业微信） / 任务派发        │
└───────┬───────────────────────┬───────────────────────────┬───────────────────────┘
        │                       │                           │
        │触发摄取               │新机会→匹配→通知           │投递准备/提交/巡检
        ▼                       ▼                           ▼
┌─────────────────────── Intake（数据摄取与规范化） ───────────────────────┐
│ 多来源抓取 → 解析/规范化 → 去重/合并 → 产出统一 Opportunity（带版本）    │
└──────────────────────────────┬───────────────────────────────────────────┘
                               │ Upsert
                               ▼
┌──────────────────── Repository & Index（仓储与检索：真相源） ────────────────────┐
│ 保存 Opportunity / Application / Profile / Version / 事件，提供检索与筛选       │
└───────────┬───────────────────────────┬───────────────────────────┬──────────────┘
            │                           │                           │
            │读取机会/偏好               │读写投递记录               │读写资料
            ▼                           ▼                           ▼
┌──────────── Matching & AI Services ────────────┐   ┌──────── Submission & Tracking ────────┐
│ 规则打分 +（可选）AI 生成理由/文书（Dify/LLM） │   │ 资料打包 → 表单预填/提交 → 回执 → 跟踪 │
│ 统一 LLM 适配，可热切换、可回退               │   │ 状态机与审计（截图/原文）               │
└───────────────────────────────────────────────┘   └───────────────────────────────────────┘
```

---

## 🎯 总结

### 核心优势
- **模块分工**：Intake、Repository、Matching、Submission、Orchestration、UI
- **页面简化**：4 主页面 + 2 管理页
- **架构组合**：Core（业务中枢） + n8n（流程编排） + Dify（AI 专家）
- **技术优点**：解耦、可扩展、LLM 可替换、支持大陆环境

### 关键特性
- 统一的数据摄取与规范化
- 智能匹配与AI辅助
- 自动化投递与状态跟踪
- 灵活的工作流编排
- 完整的用户界面体验

ArtSlave 2.0 将为艺术家提供一个完整、智能、高效的投稿管理平台。
