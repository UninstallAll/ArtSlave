好的👌 那我就把前面我们讨论的所有关键信息完整地整合成一份文字版文档，内容尽量全面，你可以直接拿去用或再加工。

---

# 🎨 艺术家机会平台 – 架构与设计文档（整合版）

## 一、总体目标

本系统面向艺术家与艺术学者，提供**机会发现 → 匹配 → 投递 → 跟踪**的一体化流程。

架构采用**混合方案**：

* **Core 服务**：作为业务中枢，负责数据真相源、复杂逻辑、投递引擎、LLM 适配。
* **n8n**：作为编排与通知层，负责定时任务、事件触发、审批流、消息推送。
* **Dify**：作为 AI 子系统，负责解析补全、匹配理由、文书润色、RAG、模型切换。

这样分工的优点：

* 各部分职责清晰、可扩展；
* LLM 可随时替换（GPT/Claude/国产模型/本地 LLM）；
* 兼容中国大陆环境（自托管、国产模型、飞书/企业微信通知）。

---

## 二、后台模块（逻辑分工）

为了降低复杂度，整合为 **6 大模块**：

### 1. 数据摄取与规范化（Intake）

* **职责**：
  抓取外部来源（网站、RSS、API、邮件） → 解析成统一结构 → 去重合并 → 生成 `Opportunity`（机会对象）。
* **产物**：
  `Opportunity`（字段：标题、机构、截止日、地点、费用、类型、urls、fingerprint、versions）。
* **MVP**：先支持少量来源，能稳定产出统一字段。
* **增强**：
  LLM 辅助字段提取/摘要（失败回退到规则解析）；机构别名库；防爬/登录支持。

---

### 2. 仓储与检索（Repository & Index）

* **职责**：
  存储 `Opportunity`、`Application`（投递）、`Profile`（用户资料）；提供查询、筛选、搜索。
* **产物**：
  关系数据库（真相源） + 全文检索索引。
* **MVP**：

  * 表结构：机会、版本、用户、资料、投递。
  * 基本查询（截止日、国家、类型、费用）。
* **增强**：
  审计日志、版本追溯、高级筛选、收藏/标签。

---

### 3. 匹配与 AI 服务（Matching & AI Services）

* **职责**：
  给每个 `Opportunity` 计算与用户的匹配度；生成“匹配理由”；润色文书（Statement/CV/作品描述）。
* **产物**：
  `Match{user_id, score, reasons}`。
* **MVP**：
  规则匹配（学科、地域、费用、截止窗），达标后调用 LLM 生成理由。
* **增强**：
  RAG（引入往届项目资料）；反馈学习；多语种输出。

---

### 4. 投递与跟踪（Submission & Tracking）

* **职责**：
  组装投递材料 → 半自动/自动填写表单 → 提交 → 获取回执 → 状态机追踪。
* **状态机**：
  `Draft → Prepared → Submitted → Resulted(Win/Lose)`。
* **MVP**：

  * 半自动：生成材料清单、表单草稿，人工确认后提交。
  * 回执与状态存档。
* **增强**：
  表单 DSL 库、自动登录态管理、投递截图审计、D-3 截止提醒。

---

### 5. 编排与通知（Orchestration & Notifications）

* **职责**：
  建议由 **n8n** 承担，负责任务编排、人工确认、消息推送。
* **功能**：

  * 定时触发（抓取、巡检）。
  * 流程编排（新机会 → 匹配 → 通知 → 投递）。
  * 多渠道通知（邮件/飞书/企业微信）。
  * 生成待办 `Task`。
* **MVP**：

  * 每日抓取流；
  * 新机会通知流；
  * 投递准备→确认→提交流；
  * 状态巡检通知流。

---

### 6. 界面与设置（UI & Settings）

* **用户可见**：

  * 浏览机会（筛选/搜索/收藏）；
  * 查看匹配与理由；
  * 我的资料（CV、Statement、作品库）；
  * 投递看板（按状态）；
  * 设置（偏好、通知渠道、模型选择）。
* **管理员可见**：

  * 数据源 & 编排页（来源配置、抓取频率、n8n 流程状态）；
  * 审计 & 分析页（投递成功率、抓取失败率、模型调用统计）。
* **交互建议**：

  * 抽屉式详情；
  * 看板式投递；
  * 通知驱动（点击直达详情）；
  * 批量操作；
  * 空状态教学。

---

## 三、页面信息架构（IA）

精简为 **4 个主页面 + 2 个管理页**：

1. **机会页（Opportunities）**

   * 列表 + 筛选/搜索/收藏。
   * 详情抽屉（摘要、来源、匹配理由、准备投递按钮）。

2. **投递 & 待办页（Tasks / Applications）**

   * 看板：Draft / Prepared / Submitted / Resulted。
   * 卡片抽屉：所需材料、草稿、回执、审计截图。

3. **我的资料页（Profile & Materials）**

   * 管理 CV、Statement 多版本、作品库。
   * 自动装配预览。

4. **设置页（Settings）**

   * 偏好、通知渠道、模型选择、语言、时区。

5. **数据源 & 编排（管理员）**

   * 来源开关、频率、n8n 流程健康状态。

6. **审计 & 分析（管理员）**

   * 投递成功率、抓取失败率、模型调用统计。

---

## 四、典型用户路径

1. **发现 → 匹配 → 投递**

   * 用户在机会页筛选 → 查看匹配分与理由 → 点击“准备投递” → 投递页卡片进入“Prepared”。

2. **巡检 → 更新结果 → 通知**

   * n8n 定时抓取 → Core 更新机会/投递状态 → n8n 推送通知 → 投递页卡片状态更新。

---

## 五、n8n 与 Dify 对比

| 维度          | n8n                      | Dify                             |
| ----------- | ------------------------ | -------------------------------- |
| **定位**      | 通用流程编排（Zapier 开源替代）      | LLM 应用平台（Prompt/RAG/多模型）         |
| **强项**      | 定时任务、触发器多、人工审批、消息通知、系统集成 | Prompt 管理、RAG 知识库、多模型切换、输出结构化、评测 |
| **弱项**      | AI 支持基础（仅发 prompt 收文本）   | 集成少，流程编排能力弱于 n8n                 |
| **数据与状态**   | 流程实例日志                   | AI 应用与资产（Prompt、知识库、模型配置）        |
| **中国大陆可用性** | 强在本地集成（飞书、企业微信、DB）       | 强在国产模型/本地模型接入                    |

**结论**：

* **只要编排 → n8n**。
* **只要 AI 应用 → Dify**。
* **两者结合 → 最合适你的场景**（流程重 + AI 也重）：

  * n8n：调度 + 通知 + 审批。
  * Dify：AI 子任务（解析、理由、文书、RAG）。
  * Core：数据与投递引擎。

---

## 六、总结

* **模块分工**：Intake、Repository、Matching、Submission、Orchestration、UI。
* **页面简化**：4 主页面 + 2 管理页。
* **架构组合**：Core（业务中枢） + n8n（流程编排） + Dify（AI 专家）。
* **优点**：解耦、可扩展、LLM 可替换、支持大陆环境。

---

要不要我帮你把这份文档再“画一张示意图”（ASCII 或流程图风格），让你能一眼看到 **Core、n8n、Dify 与用户界面**的关系？
